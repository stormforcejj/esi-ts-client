/* tslint:disable */
/* eslint-disable */
/* This file is auto-generated by OpenAPI Generator. DO NOT EDIT manually. */

import { Configuration, Middleware } from "./";
import { headersConfigMiddleware } from "../middleware/userAgent";
import { ratelimitingMiddleware } from "../middleware/ratelimiting";
import { cachingMiddleware } from "../middleware/caching";

import { EsiClientConfig, EsiCacheStrategy } from "../types/config";

import dotenv from 'dotenv';

{{#apiInfo.apis}}
import { {{classname}} } from "./apis/{{classFilename}}";
{{/apiInfo.apis}}

export * from "./models";
export * from "./apis";

export class EsiClient {
{{#apiInfo.apis}}
  public readonly {{#lambda.camelcase}}{{classname}}{{/lambda.camelcase}} : {{classname}};
{{/apiInfo.apis}}

  private cacheStrategy : EsiCacheStrategy;

  constructor(config?: EsiClientConfig) {
    const packageJson = require("../../package.json");
    
    dotenv.config({quiet: true})

    const userAgent = process.env.ESI_USER_AGENT;

    if(!userAgent || userAgent === "") {
        throw Error("User agent must be specified in the env file")
    }

    const fullUserAgent =
            userAgent +
            ` using stormforcejj/esi-ts-client/${
                packageJson.version || "X.X.X"
            } (+https://github.com/stormforcejj/esi-ts-client discord:stormforcejj esi-client@stormforcejj.co.uk)`;

    let middleware : Middleware[] = [headersConfigMiddleware(fullUserAgent), ratelimitingMiddleware()]

    this.cacheStrategy = !process.env.ESI_CACHE_STRATEGY ? EsiCacheStrategy.MEMORY : process.env.ESI_CACHE_STRATEGY as EsiCacheStrategy  

    if(this.cacheStrategy !== EsiCacheStrategy.NONE) {
        middleware.push(cachingMiddleware())
    }

    const configuration = new Configuration({
      middleware: middleware,
    });

{{#apiInfo.apis}}
    this.{{#lambda.camelcase}}{{classname}}{{/lambda.camelcase}} = new {{classname}}(configuration);
{{/apiInfo.apis}}
  }
}